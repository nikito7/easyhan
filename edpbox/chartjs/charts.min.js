const borderColors=['rgb( 72, 143, 194)','rgb(131,  83, 209)','rgb(255, 166,   0)']
const backgroundColors=['rgba( 72, 143, 194, 0.5)','rgba(131,  83, 209, 0.5)','rgba(255, 166,   0, 0.5)']
const fillColors=['rgba( 72, 143, 194, 0.2)','rgba(131,  83, 209, 0.2)','rgba(255, 166,   0, 0.2)']
const zoomOptions={pan:{enabled:true,mode:'x'},zoom:{wheel:{enabled:true,modifierKey:"ctrl",},pinch:{enabled:true},mode:'x'}}
function makeChart(canvas,dataSet,title){var timeLabel1=dataSet.slice(1).map(function(row){return row[0];});var dataset1=[];for(var i=1;i<dataSet[0].length;i++){if(dataSet[0][i]!='')dataset1.push({label:dataSet[0][i],data:dataSet.slice(1).map(function(row){return row[i]}),fill:false,borderColor:borderColors[i-1],backgroundColor:backgroundColors[i-1],pointBackgroundColor:backgroundColors[i-1],fillColor:backgroundColors[i-1],tension:0.1})}
Chart.defaults.color='rgb(120, 120, 120)'
var ctx1=new Chart(document.getElementById(canvas).getContext('2d'),{type:'line',data:{labels:timeLabel1,datasets:dataset1,},options:{legend:{display:true,},elements:{point:{radius:((dataSet.length>31)?1:2)}},interaction:{mode:'index',axis:'y'},scales:{y:{beginAtZero:true,display:true,title:{display:true,text:((dataSet.length>31)?'kWh/15min':'kWh'),
color:'#191'}}},plugins:{zoom:zoomOptions,title:{display:true,text:title,padding:{top:15,bottom:15}}}}})
ctx1.canvas.style.touchAction="pan-y";}
$(document).ready(function(){$(".nav a").each(function(){if(this.href==document.URL.split('&')[0]){$(this).addClass('active');}})
var params=new window.URLSearchParams(window.location.search);switch(params.get('d')){case'30':var d=new Date()
var mes=(params.get('m'))?params.get('m'):d.getMonth()+1
var ano=(params.get('a'))?params.get('a'):d.getFullYear()
var mo=moment(ano+'-'+mes,'YYYY-MM')
var fileName='/ufs/LP-'+mo.format('YYYY-MM')+'.csv'
var nextF='/ufs/LP-'+mo.add(1,'M').format('YYYY-MM')+'.csv'
var nextM=mo.format('MM[&a=]YYYY');var prevF='/ufs/LP-'+mo.subtract(2,'M').format('YYYY-MM')+'.csv'
var prevM=mo.format('MM[&a=]YYYY');$("#navMes").show()
$('#atual').html('| '+ano+'/'+mes)
$.get(prevF).done(function(){$('#prev').show()
$('#prev a').attr('href',window.location.pathname+'?d=30&m='+prevM);})
$.get(nextF).done(function(){$('#next').show()
$('#next a').attr('href',window.location.pathname+'?d=30&m='+nextM);})
$.get(fileName,{'_':$.now()},function(csvString){var data=Papa.parse(csvString).data;makeChart('chart1',data,'Energia - 30 Dias')})
$("#chart2").hide()
$("#chart3").hide()
break;default:$("#navMes").hide()
$.get('/ufs/0d.csv',{'_':$.now()},function(csvString){var data=Papa.parse(csvString).data;makeChart('chart1',data,'Energia - Hoje')})
$.get('/ufs/1d.csv',{'_':$.now()},function(csvString){var data=Papa.parse(csvString).data;makeChart('chart2',data,'Energia - Ontem')})
$.get('/ufs/2d.csv',{'_':$.now()},function(csvString){var data=Papa.parse(csvString).data;makeChart('chart3',data,'Energia - Anteontem')})}});
